SKIP NAVIGATION LINKSOVERVIEWPACKAGECLASSUSETREEDEPRECATEDINDEXHELPJavaâ„¢ Platform
Standard Ed. 8PREV CLASSNEXT CLASSFRAMESNO FRAMESALL CLASSESSUMMARY: NESTED | FIELD | CONSTR | METHODDETAIL: FIELD | CONSTR | METHOD
compact1, compact2, compact3
java.util.concurrent
Class ForkJoinPool
java.lang.Object
java.util.concurrent.AbstractExecutorService
java.util.concurrent.ForkJoinPool
All Implemented Interfaces:
Executor, ExecutorService

public class ForkJoinPool
extends AbstractExecutorService
An ExecutorService for running ForkJoinTasks. A ForkJoinPool provides the entry point for submissions from non-ForkJoinTask clients, as well as management and monitoring operations.
A ForkJoinPool differs from other kinds of ExecutorService mainly by virtue of employing work-stealing: all threads in the pool attempt to find and execute tasks submitted to the pool and/or created by other active tasks (eventually blocking waiting for work if none exist). This enables efficient processing when most tasks spawn other subtasks (as do most ForkJoinTasks), as well as when many small tasks are submitted to the pool from external clients. Especially when setting asyncMode to true in constructors, ForkJoinPools may also be appropriate for use with event-style tasks that are never joined.

A static commonPool() is available and appropriate for most applications. The common pool is used by any ForkJoinTask that is not explicitly submitted to a specified pool. Using the common pool normally reduces resource usage (its threads are slowly reclaimed during periods of non-use, and reinstated upon subsequent use).

For applications that require separate or custom pools, a ForkJoinPool may be constructed with a given target parallelism level; by default, equal to the number of available processors. The pool attempts to maintain enough active (or available) threads by dynamically adding, suspending, or resuming internal worker threads, even if some tasks are stalled waiting to join others. However, no such adjustments are guaranteed in the face of blocked I/O or other unmanaged synchronization. The nested ForkJoinPool.ManagedBlocker interface enables extension of the kinds of synchronization accommodated.

In addition to execution and lifecycle control methods, this class provides status check methods (for example getStealCount()) that are intended to aid in developing, tuning, and monitoring fork/join applications. Also, method toString() returns indications of pool state in a convenient form for informal monitoring.

As is the case with other ExecutorServices, there are three main task execution methods summarized in the following table. These are designed to be used primarily by clients not already engaged in fork/join computations in the current pool. The main forms of these methods accept instances of ForkJoinTask, but overloaded forms also allow mixed execution of plain Runnable- or Callable- based activities as well. However, tasks that are already executing in a pool should normally instead use the within-computation forms listed in the table unless using async event-style tasks that are not usually joined, in which case there is little difference among choice of methods.

Summary of task execution methods
Call from non-fork/join clients	Call from within fork/join computations
Arrange async execution	execute(ForkJoinTask)	ForkJoinTask.fork()
Await and obtain result	invoke(ForkJoinTask)	ForkJoinTask.invoke()
Arrange exec and obtain Future	submit(ForkJoinTask)	ForkJoinTask.fork() (ForkJoinTasks are Futures)
The common pool is by default constructed with default parameters, but these may be controlled by setting three system properties:

java.util.concurrent.ForkJoinPool.common.parallelism - the parallelism level, a non-negative integer
java.util.concurrent.ForkJoinPool.common.threadFactory - the class name of a ForkJoinPool.ForkJoinWorkerThreadFactory
java.util.concurrent.ForkJoinPool.common.exceptionHandler - the class name of a Thread.UncaughtExceptionHandler
If a SecurityManager is present and no factory is specified, then the default pool uses a factory supplying threads that have no Permissions enabled. The system class loader is used to load these classes. Upon any error in establishing these settings, default parameters are used. It is possible to disable or limit the use of threads in the common pool by setting the parallelism property to zero, and/or using a factory that may return null. However doing so may cause unjoined tasks to never be executed.
Implementation notes: This implementation restricts the maximum number of running threads to 32767. Attempts to create pools with greater than the maximum number result in IllegalArgumentException.

This implementation rejects submitted tasks (that is, by throwing RejectedExecutionException) only when the pool is shut down or internal resources have been exhausted.

Since:
1.7
Nested Class Summary
Nested Classes
Modifier and Type	Class and Description
static interface 	ForkJoinPool.ForkJoinWorkerThreadFactory
Factory for creating new ForkJoinWorkerThreads.
static interface 	ForkJoinPool.ManagedBlocker
Interface for extending managed parallelism for tasks running in ForkJoinPools.
Field Summary
Fields
Modifier and Type	Field and Description
static ForkJoinPool.ForkJoinWorkerThreadFactory	defaultForkJoinWorkerThreadFactory
Creates a new ForkJoinWorkerThread.
Constructor Summary
Constructors
Constructor and Description
ForkJoinPool()
Creates a ForkJoinPool with parallelism equal to Runtime.availableProcessors(), using the default thread factory, no UncaughtExceptionHandler, and non-async LIFO processing mode.
ForkJoinPool(int parallelism)
Creates a ForkJoinPool with the indicated parallelism level, the default thread factory, no UncaughtExceptionHandler, and non-async LIFO processing mode.
ForkJoinPool(int parallelism, ForkJoinPool.ForkJoinWorkerThreadFactory factory, Thread.UncaughtExceptionHandler handler, boolean asyncMode)
Creates a ForkJoinPool with the given parameters.
Method Summary
All MethodsStatic MethodsInstance MethodsConcrete Methods
Modifier and Type	Method and Description
boolean	awaitQuiescence(long timeout, TimeUnit unit)
If called by a ForkJoinTask operating in this pool, equivalent in effect to ForkJoinTask.helpQuiesce().
boolean	awaitTermination(long timeout, TimeUnit unit)
Blocks until all tasks have completed execution after a shutdown request, or the timeout occurs, or the current thread is interrupted, whichever happens first.
static ForkJoinPool	commonPool()
Returns the common pool instance.
protected int	drainTasksTo(Collection<? super ForkJoinTask<?>> c)
Removes all available unexecuted submitted and forked tasks from scheduling queues and adds them to the given collection, without altering their execution status.
void	execute(ForkJoinTask<?> task)
Arranges for (asynchronous) execution of the given task.
void	execute(Runnable task)
Executes the given command at some time in the future.
int	getActiveThreadCount()
Returns an estimate of the number of threads that are currently stealing or executing tasks.
boolean	getAsyncMode()
Returns true if this pool uses local first-in-first-out scheduling mode for forked tasks that are never joined.
static int	getCommonPoolParallelism()
Returns the targeted parallelism level of the common pool.
ForkJoinPool.ForkJoinWorkerThreadFactory	getFactory()
Returns the factory used for constructing new workers.
int	getParallelism()
Returns the targeted parallelism level of this pool.
int	getPoolSize()
Returns the number of worker threads that have started but not yet terminated.
int	getQueuedSubmissionCount()
Returns an estimate of the number of tasks submitted to this pool that have not yet begun executing.
long	getQueuedTaskCount()
Returns an estimate of the total number of tasks currently held in queues by worker threads (but not including tasks submitted to the pool that have not begun executing).
int	getRunningThreadCount()
Returns an estimate of the number of worker threads that are not blocked waiting to join tasks or for other managed synchronization.
long	getStealCount()
Returns an estimate of the total number of tasks stolen from one thread's work queue by another.
Thread.UncaughtExceptionHandler	getUncaughtExceptionHandler()
Returns the handler for internal worker threads that terminate due to unrecoverable errors encountered while executing tasks.
boolean	hasQueuedSubmissions()
Returns true if there are any tasks submitted to this pool that have not yet begun executing.
<T> T	invoke(ForkJoinTask<T> task)
Performs the given task, returning its result upon completion.
<T> List<Future<T>>	invokeAll(Collection<? extends Callable<T>> tasks)
Executes the given tasks, returning a list of Futures holding their status and results when all complete.
boolean	isQuiescent()
Returns true if all worker threads are currently idle.
boolean	isShutdown()
Returns true if this pool has been shut down.
boolean	isTerminated()
Returns true if all tasks have completed following shut down.
boolean	isTerminating()
Returns true if the process of termination has commenced but not yet completed.
static void	managedBlock(ForkJoinPool.ManagedBlocker blocker)
Runs the given possibly blocking task.
protected <T> RunnableFuture<T>	newTaskFor(Callable<T> callable)
Returns a RunnableFuture for the given callable task.
protected <T> RunnableFuture<T>	newTaskFor(Runnable runnable, T value)
Returns a RunnableFuture for the given runnable and default value.
protected ForkJoinTask<?>	pollSubmission()
Removes and returns the next unexecuted submission if one is available.
void	shutdown()
Possibly initiates an orderly shutdown in which previously submitted tasks are executed, but no new tasks will be accepted.
List<Runnable>	shutdownNow()
Possibly attempts to cancel and/or stop all tasks, and reject all subsequently submitted tasks.
<T> ForkJoinTask<T>	submit(Callable<T> task)
Submits a value-returning task for execution and returns a Future representing the pending results of the task.
<T> ForkJoinTask<T>	submit(ForkJoinTask<T> task)
Submits a ForkJoinTask for execution.
ForkJoinTask<?>	submit(Runnable task)
Submits a Runnable task for execution and returns a Future representing that task.
<T> ForkJoinTask<T>	submit(Runnable task, T result)
Submits a Runnable task for execution and returns a Future representing that task.
String	toString()
Returns a string identifying this pool, as well as its state, including indications of run state, parallelism level, and worker and task counts.
Methods inherited from class java.util.concurrent.AbstractExecutorService
invokeAll, invokeAny, invokeAny
Methods inherited from class java.lang.Object
clone, equals, finalize, getClass, hashCode, notify, notifyAll, wait, wait, wait
Field Detail
defaultForkJoinWorkerThreadFactory
public static final ForkJoinPool.ForkJoinWorkerThreadFactory defaultForkJoinWorkerThreadFactory
Creates a new ForkJoinWorkerThread. This factory is used unless overridden in ForkJoinPool constructors.
Constructor Detail
ForkJoinPool
public ForkJoinPool()
Creates a ForkJoinPool with parallelism equal to Runtime.availableProcessors(), using the default thread factory, no UncaughtExceptionHandler, and non-async LIFO processing mode.
Throws:
SecurityException - if a security manager exists and the caller is not permitted to modify threads because it does not hold RuntimePermission("modifyThread")
ForkJoinPool
public ForkJoinPool(int parallelism)
Creates a ForkJoinPool with the indicated parallelism level, the default thread factory, no UncaughtExceptionHandler, and non-async LIFO processing mode.
Parameters:
parallelism - the parallelism level
Throws:
IllegalArgumentException - if parallelism less than or equal to zero, or greater than implementation limit
SecurityException - if a security manager exists and the caller is not permitted to modify threads because it does not hold RuntimePermission("modifyThread")
ForkJoinPool
public ForkJoinPool(int parallelism,
                    ForkJoinPool.ForkJoinWorkerThreadFactory factory,
                    Thread.UncaughtExceptionHandler handler,
                    boolean asyncMode)
Creates a ForkJoinPool with the given parameters.
Parameters:
parallelism - the parallelism level. For default value, use Runtime.availableProcessors().
factory - the factory for creating new threads. For default value, use defaultForkJoinWorkerThreadFactory.
handler - the handler for internal worker threads that terminate due to unrecoverable errors encountered while executing tasks. For default value, use null.
asyncMode - if true, establishes local first-in-first-out scheduling mode for forked tasks that are never joined. This mode may be more appropriate than default locally stack-based mode in applications in which worker threads only process event-style asynchronous tasks. For default value, use false.
Throws:
IllegalArgumentException - if parallelism less than or equal to zero, or greater than implementation limit
NullPointerException - if the factory is null
SecurityException - if a security manager exists and the caller is not permitted to modify threads because it does not hold RuntimePermission("modifyThread")
Method Detail
commonPool
public static ForkJoinPool commonPool()
Returns the common pool instance. This pool is statically constructed; its run state is unaffected by attempts to shutdown() or shutdownNow(). However this pool and any ongoing processing are automatically terminated upon program System.exit(int). Any program that relies on asynchronous task processing to complete before program termination should invoke commonPool().awaitQuiescence, before exit.
Returns:
the common pool instance
Since:
1.8
invoke
public <T> T invoke(ForkJoinTask<T> task)
Performs the given task, returning its result upon completion. If the computation encounters an unchecked Exception or Error, it is rethrown as the outcome of this invocation. Rethrown exceptions behave in the same way as regular exceptions, but, when possible, contain stack traces (as displayed for example using ex.printStackTrace()) of both the current thread as well as the thread actually encountering the exception; minimally only the latter.
Type Parameters:
T - the type of the task's result
Parameters:
task - the task
Returns:
the task's result
Throws:
NullPointerException - if the task is null
RejectedExecutionException - if the task cannot be scheduled for execution
execute
public void execute(ForkJoinTask<?> task)
Arranges for (asynchronous) execution of the given task.
Parameters:
task - the task
Throws:
NullPointerException - if the task is null
RejectedExecutionException - if the task cannot be scheduled for execution
execute
public void execute(Runnable task)
Description copied from interface: Executor
Executes the given command at some time in the future. The command may execute in a new thread, in a pooled thread, or in the calling thread, at the discretion of the Executor implementation.
Parameters:
task - the runnable task
Throws:
NullPointerException - if the task is null
RejectedExecutionException - if the task cannot be scheduled for execution
submit
public <T> ForkJoinTask<T> submit(ForkJoinTask<T> task)
Submits a ForkJoinTask for execution.
Type Parameters:
T - the type of the task's result
Parameters:
task - the task to submit
Returns:
the task
Throws:
NullPointerException - if the task is null
RejectedExecutionException - if the task cannot be scheduled for execution
submit
public <T> ForkJoinTask<T> submit(Callable<T> task)
Description copied from interface: ExecutorService
Submits a value-returning task for execution and returns a Future representing the pending results of the task. The Future's get method will return the task's result upon successful completion.
If you would like to immediately block waiting for a task, you can use constructions of the form result = exec.submit(aCallable).get();

Note: The Executors class includes a set of methods that can convert some other common closure-like objects, for example, PrivilegedAction to Callable form so they can be submitted.

Specified by:
submit in interface ExecutorService
Overrides:
submit in class AbstractExecutorService
Type Parameters:
T - the type of the task's result
Parameters:
task - the task to submit
Returns:
a Future representing pending completion of the task
Throws:
NullPointerException - if the task is null
RejectedExecutionException - if the task cannot be scheduled for execution
submit
public <T> ForkJoinTask<T> submit(Runnable task,
                                  T result)
Description copied from interface: ExecutorService
Submits a Runnable task for execution and returns a Future representing that task. The Future's get method will return the given result upon successful completion.
Specified by:
submit in interface ExecutorService
Overrides:
submit in class AbstractExecutorService
Type Parameters:
T - the type of the result
Parameters:
task - the task to submit
result - the result to return
Returns:
a Future representing pending completion of the task
Throws:
NullPointerException - if the task is null
RejectedExecutionException - if the task cannot be scheduled for execution
submit
public ForkJoinTask<?> submit(Runnable task)
Description copied from interface: ExecutorService
Submits a Runnable task for execution and returns a Future representing that task. The Future's get method will return null upon successful completion.
Specified by:
submit in interface ExecutorService
Overrides:
submit in class AbstractExecutorService
Parameters:
task - the task to submit
Returns:
a Future representing pending completion of the task
Throws:
NullPointerException - if the task is null
RejectedExecutionException - if the task cannot be scheduled for execution
invokeAll
public <T> List<Future<T>> invokeAll(Collection<? extends Callable<T>> tasks)
Description copied from interface: ExecutorService
Executes the given tasks, returning a list of Futures holding their status and results when all complete. Future.isDone() is true for each element of the returned list. Note that a completed task could have terminated either normally or by throwing an exception. The results of this method are undefined if the given collection is modified while this operation is in progress.
Specified by:
invokeAll in interface ExecutorService
Overrides:
invokeAll in class AbstractExecutorService
Type Parameters:
T - the type of the values returned from the tasks
Parameters:
tasks - the collection of tasks
Returns:
a list of Futures representing the tasks, in the same sequential order as produced by the iterator for the given task list, each of which has completed
Throws:
NullPointerException - if tasks or any of its elements are null
RejectedExecutionException - if any task cannot be scheduled for execution
getFactory
public ForkJoinPool.ForkJoinWorkerThreadFactory getFactory()
Returns the factory used for constructing new workers.
Returns:
the factory used for constructing new workers
getUncaughtExceptionHandler
public Thread.UncaughtExceptionHandler getUncaughtExceptionHandler()
Returns the handler for internal worker threads that terminate due to unrecoverable errors encountered while executing tasks.
Returns:
the handler, or null if none
getParallelism
public int getParallelism()
Returns the targeted parallelism level of this pool.
Returns:
the targeted parallelism level of this pool
getCommonPoolParallelism
public static int getCommonPoolParallelism()
Returns the targeted parallelism level of the common pool.
Returns:
the targeted parallelism level of the common pool
Since: